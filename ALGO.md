# Как это работает
В секции "Этапы работы" указаны минимальные пояснения к действиям. В секции "Потенциальные проблемы" я честно указываю, как можно "положить" программу и почему случились описанные отклонения от первоначального плана. Также описаны улучшения, которые, может быть, удастся сделать на второй итерации (но это не точно)

## Этапы работы алгоритма:
1. Загрузка изображения
2. Применение детектора Кэнни к изображению из п. 1 для поиска границ.
3. Применение преобразования Хафа к изображению из п. 2 для поиска прямых.
4. Построение словаря: (уравнение прямой) -> (координаты концов отрезков, лежащих на прямой)
5. Поиск столешницы:
	* Выбрать все горизонтальные (критерии горизонтальности описаны в постановке задачи) прямые, находящиеся в верхней половине изображения
	* Если всё сделано правильно, должно быть обнаружено ориентировочно 2 или 3 прямые
	* Выбираем самый длинный отрезок на второй прямой. Это и есть линия, под которой должен пройти стул (балка, на которую опирается столешница)
6. Определение положения стула. Здесь рассматриваются три возможных положения:
	* **Вертикально:**
		Найдена горизонтальная прямая в третьей четверти изображения, считая сверху
	* **Горизонтально, ось спинки расположена вдоль направления взора камеры, спинка стула перпендикулярна полу:**
		Найдено как минимум две прямые, пересекающиеся в точке (x0, y0), такой что 0 <= y0 < h, x0 < 0 || x0 >= w, где w, h -- ширина и высота картинки соответственно, причём угол между прямыми не менее 10 градусов и не более 30 (простыми словами, пересечение прямых происходит сбоку от изображения и точка пересечения находится недалеко от границы -- критерием последнего служит угол между прямыми). Эти прямые содержат каркас спинки стула
	* **Горизонтально, ось спинки расположена вдоль направления взора камеры стул лежит на спинке:**
		Найдено как минимум две прямые, пересекающиеся в точке (x0, y0), такой что y0 >= h, 0 < x0 <  w, причём угол между прямыми не менее 10 градусов и не более 30 (простыми словами, пересечение прямых происходит снизу от изображения и точка пересечения находится недалеко от границы. Поскольку на некоторых изображениях, которые изначально были отмечены как подходящие, подушка перекрывает вертикальную часть каркаса спинки стула, было принято решение дополнительно проверять горизонтальные отрезки в нижней четверти изображения
	* **Горизонтально, оси спинки расположена перпендикулярно направлению взора камеры:**
		На рассмотренных изображениях с данным положением детектор Хафа, к сожалению, не нашёл полезных прямых, которые позволили бы хоть сколько-то достоверно определить это положение. Однако, поскольку в данной работе другие случаи не рассматриваются, данное положение стула будет возвращаться методом исключения и этот результат должен быть достаточно достоверным.
	
7. Принятие решения: пройдёт ли стул под стол
	* **Вертикально:**
		С учётом требований, предъявляемых в постановке задачи к размерам стола и стула на фотографии (соотношение линейных размеров объектов на изображении), становится ясно, что вертикально стоящий стул всегда *не пройдёт* под стол
	* **Горизонтально, ось спинки расположена вдоль направления взора камеры, любой поворот вокруг оси камеры:**
		Опять же, с учётом требований из постановки задачи и конкретных габаритов стула на данный момент всегда возвращается *положительный* ответ
	* **Горизонтально, ось спинки стула расположена перпендикулярно направлению взора камеры:**
		Ответ *отрицательный*


## Потенциальные проблемы (нумерация соответствует этапам работы алгоритма):
1. Параметр `sigma` меняет степень "размытости" изображения и, как следствие, количество найденных прямых. Слишком большой `sigma` приводит к тому, что находятся не все нужные прямые, слишком маленький -- к нахождению прямых, которые могут быть в дальнейшем ложным образом восприняты как границы стола или стула.
2. Преобразование Хафа не всегда распознаёт линии, которые воспринимаются человеческим глазом прямыми. Данное обстоятельство внесло значительные коррективы в первоначальный план по решению задачи. 
3. При правильно подобранных параметрах в пп. 2 и освещении, требования к которому указаны в постановке задачи данный пункт работает без проблем. Однако для лучшей работы алгоритма необходимо, чтобы фотографирование производилось без вспышки, которая ослепляет детектор Хафа.
4. Решённая проблема: корректное итерирование по точкам прямой. Для почти вертикальной и почти горизонтальной прямой -- принципиально разное (см. код).
5. Иногда находится не балка столешницы, а сама столешница (в частности, из-за вспышки). Не влияет на качество работы алгоритма, даже если будет другой стул, поскольку если стул настолько высок, что проходит под столешницу, но не под опорную балку, то не представляется возможным сделать фотографию по требованиям постановки задачи.
6. Некоторые объекты, которые изначально виделись прямыми, оказались несколько искривлены с точки зрения детектора Хафа, а другие -- наоборот. С другим стулом ситуация может ещё каким-то образом измениться.
7. На данном этапе реализации я полагаюсь на конкретные габариты стола и стула. Учитывая их, для принятия решения оказывается достаточным определить положение стула. Тем не менее, сделан определённый задел под следующую итерацию -- например, сейчас корректно ищется столешница (ревьюер при желании может это проверить) и возвращается некоторый, быть может, избыточный список прямых, по которым принималось решение о положении стула (см. `detect_vertical`, `detect_horizontal`). По этим данным теоретически можно сопоставлять границы стула и столешницу.
	Почему это не сделано сейчас? В целом, всё описано в предыдущих пунктах. Вкратце, проблема в лишних прямых, которые ослепляют мой алгоритм, и в недостающих прямых, которые оказались непрямыми.
