# Как это работает

## Этапы работы алгоритма:
1. Загрузка изображения
2. Применение детектора Кэнни к изображению из п. 1 для поиска границ.
3. Применение преобразования Хафа к изображению из п. 2 для поиска прямых.
4. Построение словаря: (уравнение прямой) -> (координаты концов отрезков, лежащих на прямой)
5. Поиск столешницы:
	* Выбрать все горизонтальные (критерии горизонтальности описаны в постановке задачи) прямые, находящиеся в верхней половине изображения
	* Если всё сделано правильно, должно быть обнаружено ориентировочно 2 или 3 прямые
	* Выбираем самый длинный отрезок на второй прямой. Это и есть линия, под которой должен пройти стул (балка, на которую опирается столешница)
6. Определение положения стула. Здесь рассматриваются три возможных положения:
	* **Вертикально:**
		Найдена горизонтальная прямая в нижней половине изображения
	
	* **Горизонтально, ось спинки расположена вдоль направления взора камеры, спинка стула перпендикулярна полу:**
		Найдено как минимум две прямые, пересекающиеся в точке (x0, y0), такой что 0 <= y0 < h, x0 < 0 || x0 >= w, где w, h -- ширина и высота картинки соответственно, причём угол между прямыми не более 30 градусов (простыми словами, пересечение прямых происходит сбоку от изображения и точка пересечения находится недалеко от границы -- критерием последнего служит угол между прямыми)
	* **Горизонтально, ось спинки расположена вдоль направления взора камеры стул лежит на спинке:**
		Найдено как минимум две прямые, пересекающиеся в точке (x0, y0), такой что y0 >= h, 0 < x0 <  w, причём угол между прямыми не более 30 градусов (простыми словами, пересечение прямых происходит снизу от изображения и точка пересечения находится недалеко от границы
	* **Горизонтально, оси спинки расположена перпендикулярно направлению взора камеры:**
		На рассмотренных изображениях с данным положением детектор Хафа, к сожалению, не нашёл полезных прямых, которые позволили бы хоть сколько-то достоверно определить это положение. Однако, поскольку в данной работе другие случаи не рассматриваются, данное положение стула будет возвращаться методом исключения и этот результат должен быть достаточно достоверным.
	
7. Принятие решения: пройдёт ли стул под стол
	* **Вертикально:**
		С учётом требований, предъявляемых в постановке задачи к размерам стола и стула на фотографии (соотношение линейных размеров объектов на изображении), становится ясно, что вертикально стоящий стул всегда *не пройдёт* под стол
	* **Горизонтально, ось спинки расположена вдоль направления взора камеры:**


Потенциальные проблемы (нумерация соответствует этапам работы алгоритма):
1. Параметр `sigma` меняет степень "размытости" изображения и, как следствие, количество найденных прямых. Слишком большой `sigma` приводит к тому, что находятся не все нужные прямые, слишком маленький -- к нахождению прямых, которые могут быть в дальнейшем ложным образом восприняты как границы стола или стула.
2. Преобразование Хафа не всегда распознаёт линии, которые воспринимаются человеческим глазом прямыми. Данное обстоятельство внесло значительные коррективы в первоначальный план по решению задачи. 
Возможно, читателю алгоритма покажется, что конечное решение существенно упрощено, однако вызвав функцию `show_processed_img` он может легко убедиться в истинности предыдущего утверждения и понять, что итоговое решение является достаточно разумным в изложенных условиях.
3. При правильно подобранных параметрах в пп. 2, 3 и освещении, требования к которому указаны в постановке задачи данный пункт работает без проблем. Однако для лучшей работы алгоритма необходимо, чтобы фотографирование производилось без вспышки, которая ослепляет детектор Хафа.
